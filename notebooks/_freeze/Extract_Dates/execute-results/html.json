{
  "hash": "2f91b474ae1c00cb6f4c50d41fd1e30c",
  "result": {
    "markdown": "---\ntitle: \"Extract Important Dates\"\nformat: html\neditor: visual\n---\n\n\nThis notebook is for extracting dates out of both the border wait time data and important dates for the Beitbridge border crossing. The important dates data set was generated through searching news articles, YouTube and other sources related to delays at the border crossing.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(tidyverse)\nlibrary(stringr)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nimportant_dates = read_csv(\"../data/raw/beitbridge_dates_of_interest.csv\")\n\nborder_data = read_csv(\"../data/processed/Beitbridge_Counts_Wait_Time_2018_2022.csv\")\n```\n:::\n\n\nFormat the important dates data to have start and end dates. Here we are splitting based on the arrow symbol. This is an artifact from Notion DB.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimportant_dates = important_dates %>%\n  mutate(start_date = mdy(if_else(str_detect(Date, '→'),\n                              str_split(important_dates$Date, '→', n=2, simplify = TRUE)[,1],\n                              Date)),\n         end_date = mdy(if_else(str_detect(Date, '→'),\n                              str_split(important_dates$Date, '→', n=2, simplify = TRUE)[,2],\n                              Date)))\n```\n:::\n\n\nFormat the border crossing dates as date time\n\n\n::: {.cell}\n\n```{.r .cell-code}\nborder_data$datetime <- ymd_h(paste(border_data$StartDate, border_data$StartHour))\n```\n:::\n\n\nFunction to splice the data based on a date range for border data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function for selecting a range of dates for border data with StartDate field\nget_specific_dates = function(start_date, end_date, data){\n  int = interval(ymd(start_date), ymd(end_date))\n  df = data %>%\n    filter(StartDate %within% int)\n  df\n}\n```\n:::\n\n\nApply the function to our border data. Here we're using the dates where we know there was an event and where we have high res imagery.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get December 2022\ndf = get_specific_dates('2022-12-24', '2022-12-24', border_data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_date = '2022-12-24'\nend_date = '2022-12-24'\nint = interval(ymd(start_date), ymd(end_date))\nimportant_dates %>% filter(start_date %within% int)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|Name                                                            |Tags  |Date              |Description |URL                                                                                                                                |start_date |end_date   |\n|:---------------------------------------------------------------|:-----|:-----------------|:-----------|:----------------------------------------------------------------------------------------------------------------------------------|:----------|:----------|\n|Large queues at Beitbridge due to immigration of 20 000+ people |delay |December 24, 2022 |NA          |https://www.sabcnews.com/sabcnews/more-than-20-000-immigrants-cross-from-south-africa-into-zimbabwe-at-the-beitbridge-border-post/ |2022-12-24 |2022-12-24 |\n\n</div>\n:::\n:::\n\n\n## Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  ggplot(aes(x = Count_Events, y = Median_Minutes, group = Direction, col = Direction)) + \n  geom_point() +\n  scale_color_viridis_d(alpha=0.3,option = \"plasma\", end = .7) +\n  labs(y =\" Median Minutes\", x = \"Total Count\", title = \"Border Wait Time and Counts\", subtitle = \"December 24th, 2022\")\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  ggplot(aes(x = StartHour, y = Median_Minutes, group= as_factor(Direction), col = as_factor(Direction))) + \n  geom_point(alpha = 0.7) +\n  geom_line()+\n  scale_color_viridis_d(option = \"plasma\", end = .7)+\n  labs(x= 'Hour of Day', y = 'Median Minutes', col=\"Direction\", title = 'December 24, 2022', caption = \"*Note missing data\")\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  ggplot(aes(x = StartHour, y = Count_Events, group= as_factor(Direction), col = as_factor(Direction))) + \n  geom_point(alpha = 0.7) +\n  geom_line()+\n  scale_color_viridis_d(option = \"plasma\", end = .7)+\n  labs(x= 'Hour', y = 'Count', col=\"Direction\", title = 'December 24, 2022')\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Cumulative Sum\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  group_by(Direction)%>%\n  mutate(cumulative_count = cumsum(Count_Events))%>%\n  ggplot(aes(x = StartHour, y = cumulative_count , group= as_factor(Direction), col = as_factor(Direction))) + \n  geom_point(alpha = 0.7) +\n  geom_line()+\n  scale_color_viridis_d(option = \"plasma\", end = .7)+\n  labs(x= 'Hour', y = 'Cumulative Sum', col=\"Direction\", title = 'December 24, 2022')\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n  group_by(Direction)%>%\n  mutate(cumulative_count = cumsum(Count_Events))%>%\n  ggplot(aes(x = StartHour, y = cumulative_count , group= as_factor(Direction), col = as_factor(Direction))) + \n  geom_point(alpha = 0.7) +\n  geom_line()+\n  scale_color_viridis_d(option = \"plasma\", end = .7)+\n  labs(x= 'Hour', y = 'Cumulative Sum', col=\"Direction\", title = 'December 24, 2022')\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## Month Plots\n\nThe plots below are looking at the month of December 2022.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nborder_data %>%\n    filter(year(StartDate)=='2022', month(StartDate)==12)%>%\n    group_by(Direction, StartDate)%>%\n    arrange(Direction, StartDate)%>%\n    summarize(daily_count = sum(Count_Events, na.rm=T))%>%\n    mutate(cumulative_sum =  cumsum(daily_count))%>%\n  ggplot(aes(x = StartDate, y = cumulative_sum , group= as_factor(Direction), col = as_factor(Direction))) + \n  geom_point(alpha = 0.7) +\n  geom_line()+\n  scale_color_viridis_d(option = \"plasma\", end = .7)+\n  labs(x= 'Date', y = 'Cumulative Sum', col=\"Direction\", title = 'December, 2022')\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nborder_data %>%\n  filter(year(StartDate)=='2022', month(StartDate)==12)%>%\n  group_by(StartDate, Direction)%>%\n  summarize(max_median = max(Median_Minutes,na.rm=T))%>%\n  ggplot(aes(x=StartDate,y = max_median, group= as_factor(Direction), col = as_factor(Direction))) + \n  geom_point(alpha = 0.7) +\n  geom_line()+\n  scale_color_viridis_d(option = \"plasma\", end = .7)+\n  scale_x_date(date_labels = \"%d\",date_breaks = '2 days', limits =c(as_date('2022-12-01'),as_date('2022-12-31') )) +\n  theme(axis.text.x=element_text(angle=60, hjust=1)) +\n  labs(x= 'Day', y = 'Max Daily Median Wait Time', col=\"Direction\", title = 'December 2022')\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n## Hourly Scatter Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nborder_data %>%\n    filter(Direction == 'SA-Zimbabwe')%>%\n    filter(year(StartDate)=='2022', month(StartDate)==12)%>%\n    ggplot(aes(x=datetime, y=Median_Minutes, group=as_factor(Direction), col=as_factor(Direction)))+\n    geom_point(alpha = 0.7) +\n    #geom_line()+\n    labs(x= 'Day', y = 'Median Hourly Wait Time', col=\"Direction\", title = 'December 2022')+\n    scale_color_viridis_d(option = \"plasma\", end = .7)\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nborder_data %>%\n    filter(Direction == 'Zimbabwe-SA')%>%\n    filter(year(StartDate)=='2022', month(StartDate)==12)%>%\n    ggplot(aes(x=datetime, y=Median_Minutes, group=as_factor(Direction), col=as_factor(Direction)))+\n    geom_point(alpha = 0.7) +\n    #geom_line()+\n    labs(x= 'Day', y = 'Median Hourly Wait Time', col=\"Direction\", title = 'December 2022')+\n    scale_color_viridis_d(option = \"magma\", end = .7)\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nborder_data %>%\n  filter(year(StartDate)=='2022', month(StartDate)==12)%>%\n  group_by(StartDate, Direction)%>%\n  summarize(Total_Count= sum(Count_Events,na.rm=T))%>%\n  ggplot(aes(x=StartDate,y = Total_Count, group= as_factor(Direction), col = as_factor(Direction))) + \n  geom_point(alpha = 0.7) +\n  geom_line()+\n  scale_color_viridis_d(option = \"plasma\", end = .7)+\n  labs(x= 'Day', y = 'Total Count', col=\"Direction\", title = 'December 2022')\n```\n\n::: {.cell-output-display}\n![](Extract_Dates_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Extract_Dates_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}